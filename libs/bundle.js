!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";n(1),n(2),n(3)},function(e,t){"use strict";t.app=angular.module("app",["ngMaterial","ui.router","ngMessages","ngStorage"])},function(e,t,n){"use strict";var i=n(1).app;i.config(["$urlRouterProvider","$locationProvider",function(e,t){t.html5Mode(!0),e.when("","/").otherwise("/")}]),i.config(["$stateProvider",function(e){e.state("index",{url:"/",controller:"IndexController",templateUrl:"/public/views/index.html"}).state("history",{url:"/history",controller:"HistoryController",templateUrl:"/public/views/history.html"})}])},function(e,t,n){"use strict";var i=n(1).app;i.controller("MainController",["$scope","$mdSidenav","$state","$mdDialog","$localStorage","$interval",function(e,t,n,i,o,a){o.$default({autoChange:!1,autoShowHelpInfo:!0,imagesHistory:[]}),e.autoChange={status:o.autoChange,interval:null},e.setAutoChange=function(){o.autoChange=e.autoChange.status},e.historyIndex=!1,e.setHistoryIndex=function(t){e.historyIndex=t},e.index=0,e.setIndex=function(t){e.index=t},e.images=[],e.openMenu=function(){t("left").toggle()},e.helpDialog={autoShow:o.autoShowHelpInfo},e.setHelpInfo=function(){o.autoShowHelpInfo=e.helpDialog.autoShow},e.showHelpDialog=function(){e.dialog=i.show({preserveScope:!0,scope:e,templateUrl:"/public/views/help.html",parent:angular.element(document.body),clickOutsideToClose:!0})},e.closeDialog=function(){i.hide(e.dialog)},e.menus=[{name:"首页",icon:"home",click:function(){return n.go("index")}},{name:"浏览记录",icon:"history",click:function(){return n.go("history")}},{name:"帮助",icon:"help_outline",click:function(){return e.showHelpDialog()}}],e.menuClick=function(n){e.menus[n].click(),t("left").close()},e.$on("$stateChangeStart",function(t,n,i,o,r,s){"index"===o.name&&e.autoChange.interval&&a.cancel(e.autoChange.interval)})}]).controller("IndexController",["$scope","$http","$state","$stateParams","$timeout","$interval","$localStorage",function(e,t,n,i,o,a,r){r.autoShowHelpInfo&&!e.historyIndex&&e.showHelpDialog(),e.getImages=function(){e.images.length>15||t.get("/random").then(function(t){return e.images.indexOf(t.data)>0?e.getImages():(e.images.length||(r.imagesHistory.push(t.data),e.setIndex(0)),e.images.push(t.data),void e.getImages())}).catch(function(){o(function(){e.getImages()},1500)})},e.historyIndex&&(e.images[0]={id:r.imagesHistory[e.index].id,url:r.imagesHistory[e.index].url},e.setHistoryIndex(!1)),e.getImages(),e.random=function(t){e.getImages(),e.images.splice(0,1),e.images[0]&&r.imagesHistory.push(e.images[0]),r.imagesHistory.length>60&&r.imagesHistory.splice(0,r.imagesHistory.length-60),e.setIndex(r.imagesHistory.length-1),t||(e.autoChange.interval&&a.cancel(e.autoChange.interval),e.autoChange.status&&(e.autoChange.interval=a(function(){e.random(!0)},1e4)))},e.next=function(){e.index<r.imagesHistory.length-1?(e.setIndex(e.index+1),e.images[0]=r.imagesHistory[e.index]):e.random()},e.prev=function(){e.index>0&&(e.setIndex(e.index-1),e.images[0]=r.imagesHistory[e.index])},e.$watch("autoChange.status",function(){return e.autoChange.status?void(e.autoChange.interval=a(function(){e.random(!0)},1e4)):void(e.autoChange.interval&&a.cancel(e.autoChange.interval))})}]).controller("HistoryController",["$scope","$localStorage","$state","$mdMedia",function(e,t,n,i){return t.imagesHistory?(e.divHeightStyle={height:100/3+"vw"},i("md")&&(e.divHeightStyle.height="25vw"),i("gt-md")&&(e.divHeightStyle.height=100/6+"vw"),e.history=t.imagesHistory.map(function(e){return{id:e.id,url:e.url,width:1,height:1,style:{width:"100%",overflow:"hidden"}}}),e.history.forEach(function(t,n){var i=new Image;i.onload=function(){e.history[n].width=i.width,e.history[n].height=i.height,i.height<i.width&&(e.history[n].style={height:"100%","max-width":"none","min-width":100/t.height*t.width+"%"})},i.src=t.url}),void(e.toImage=function(t){e.setHistoryIndex(!0),e.setIndex(t),n.go("index")})):n.go("index")}])}]);
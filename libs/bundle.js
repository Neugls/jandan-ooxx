!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";n(1),n(2),n(3)},function(e,t){"use strict";t.app=angular.module("app",["ngMaterial","ui.router","ngMessages","ngStorage"])},function(e,t,n){"use strict";var o=n(1).app;o.config(["$urlRouterProvider","$locationProvider",function(e,t){t.html5Mode(!0),e.when("","/").otherwise("/")}]),o.config(["$stateProvider",function(e){e.state("index",{url:"/",controller:"IndexController",templateUrl:"/public/views/index.html"}).state("history",{url:"/history",controller:"HistoryController",templateUrl:"/public/views/history.html"})}])},function(e,t,n){"use strict";var o=n(1).app;o.controller("MainController",["$scope","$mdSidenav","$state","$mdDialog","$localStorage","$interval",function(e,t,n,o,i,a){i.$default({autoChange:!1,autoShowHelpInfo:!0,imagesHistory:[]}),e.autoChange={status:i.autoChange,interval:null},e.setAutoChange=function(){i.autoChange=e.autoChange.status},e.historyIndex=!1,e.setHistoryIndex=function(t){e.historyIndex=t},e.index=0,e.setIndex=function(t){e.index=t},e.images=[],e.openMenu=function(){t("left").toggle()},e.helpDialog={autoShow:i.autoShowHelpInfo},e.setHelpInfo=function(){i.autoShowHelpInfo=e.helpDialog.autoShow},e.showHelpDialog=function(){e.dialog=o.show({preserveScope:!0,scope:e,templateUrl:"/public/views/help.html",parent:angular.element(document.body),clickOutsideToClose:!0})},e.closeDialog=function(){o.hide(e.dialog)},e.menus=[{name:"首页",icon:"home",click:function(){return n.go("index")}},{name:"浏览记录",icon:"history",click:function(){return n.go("history")}},{name:"帮助",icon:"help_outline",click:function(){return e.showHelpDialog()}}],e.menuClick=function(n){e.menus[n].click(),t("left").close()},e.$on("$stateChangeStart",function(t,n,o,i,r,s){"index"===i.name&&e.autoChange.interval&&a.cancel(e.autoChange.interval)})}]).controller("IndexController",["$scope","$http","$state","$stateParams","$timeout","$interval","$localStorage",function(e,t,n,o,i,a,r){r.autoShowHelpInfo&&!e.historyIndex&&e.showHelpDialog();var s=!1;e.getImages=function(){e.images.length>15||s||(s=!0,t.get("/random").then(function(t){s=!1,e.images.length||(r.imagesHistory.push(t.data),e.setIndex(0)),e.images.push(t.data),e.getImages()}).catch(function(){i(function(){s=!1,e.getImages()},2e3)}))},e.historyIndex&&(e.images[0]={id:r.imagesHistory[e.index].id,url:r.imagesHistory[e.index].url},e.setHistoryIndex(!1)),e.getImages(),e.random=function(t){e.getImages(),e.images.splice(0,1),e.images[0]&&r.imagesHistory.push(e.images[0]),r.imagesHistory.length>60&&r.imagesHistory.splice(0,r.imagesHistory.length-60),e.setIndex(r.imagesHistory.length-1),t||(e.autoChange.interval&&a.cancel(e.autoChange.interval),e.autoChange.status&&(e.autoChange.interval=a(function(){e.random(!0)},1e4)))},e.next=function(){e.index<r.imagesHistory.length-1?(e.setIndex(e.index+1),e.images[0]=r.imagesHistory[e.index]):e.random()},e.prev=function(){e.index>0&&(e.setIndex(e.index-1),e.images[0]=r.imagesHistory[e.index])},e.$watch("autoChange.status",function(){return e.autoChange.status?void(e.autoChange.interval=a(function(){e.random(!0)},1e4)):void(e.autoChange.interval&&a.cancel(e.autoChange.interval))})}]).controller("HistoryController",["$scope","$localStorage","$state","$mdMedia",function(e,t,n,o){return t.imagesHistory?(e.divHeightStyle={height:100/3+"vw"},o("md")&&(e.divHeightStyle.height="25vw"),o("gt-md")&&(e.divHeightStyle.height=100/6+"vw"),e.history=t.imagesHistory.map(function(e){return{id:e.id,url:e.url,width:1,height:1,style:{width:"100%",overflow:"hidden"}}}),e.history.forEach(function(t,n){var o=new Image;o.onload=function(){e.history[n].width=o.width,e.history[n].height=o.height,o.height<o.width&&(e.history[n].style={height:"100%","max-width":"none","min-width":100/t.height*t.width+"%"})},o.src=t.url}),void(e.toImage=function(t){e.setHistoryIndex(!0),e.setIndex(t),n.go("index")})):n.go("index")}])}]);
!function(e){function t(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return e[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";i(1),i(2),i(3)},function(e,t){"use strict";t.app=angular.module("app",["ngMaterial","ui.router","ngMessages","ngStorage"])},function(e,t,i){"use strict";var o=i(1).app;o.config(["$urlRouterProvider","$locationProvider",function(e,t){t.html5Mode(!0),e.when("","/").otherwise("/")}]),o.config(["$stateProvider",function(e){e.state("index",{url:"/",controller:"IndexController",templateUrl:"/public/views/index.html"}).state("history",{url:"/history",controller:"HistoryController",templateUrl:"/public/views/history.html"})}])},function(e,t,i){"use strict";var o=i(1).app;o.controller("MainController",["$scope","$mdSidenav","$state","$mdDialog","$localStorage",function(e,t,i,o,n){n.$default({autoShowHelpInfo:!0,imagesHistory:[]}),e.historyIndex=!1,e.setHistoryIndex=function(t){e.historyIndex=t},e.index=0,e.setIndex=function(t){e.index=t},e.images=[],e.openMenu=function(){t("left").toggle()},e.helpDialog={autoShow:n.autoShowHelpInfo},e.setHelpInfo=function(){n.autoShowHelpInfo=e.helpDialog.autoShow},e.showHelpDialog=function(){e.dialog=o.show({preserveScope:!0,scope:e,templateUrl:"/public/views/help.html",parent:angular.element(document.body),clickOutsideToClose:!0})},e.closeDialog=function(){o.hide(e.dialog)},e.menus=[{name:"首页",icon:"home",click:function(){return i.go("index")}},{name:"浏览记录",icon:"history",click:function(){return i.go("history")}},{name:"帮助",icon:"help_outline",click:function(){return e.showHelpDialog()}}],e.menuClick=function(i){e.menus[i].click(),t("left").close()}}]).controller("IndexController",["$scope","$http","$state","$stateParams","$timeout","$localStorage",function(e,t,i,o,n,s){s.autoShowHelpInfo&&!e.historyIndex&&e.showHelpDialog(),e.getImages=function(){e.images.length>15||t.get("/random").then(function(t){return e.images.indexOf(t.data)>0?e.getImages():(e.images.length||(s.imagesHistory.push(t.data),e.setIndex(0)),e.images.push(t.data),void e.getImages())}).catch(function(){n(function(){e.getImages()},1500)})},e.historyIndex&&(e.images[0]={id:s.imagesHistory[e.index].id,url:s.imagesHistory[e.index].url},e.setHistoryIndex(!1)),e.getImages(),e.random=function(){e.getImages(),e.images.splice(0,1),e.images[0]&&s.imagesHistory.push(e.images[0]),s.imagesHistory.length>60&&s.imagesHistory.splice(0,s.imagesHistory.length-60),e.setIndex(s.imagesHistory.length-1)},e.next=function(){e.index<s.imagesHistory.length-1?(e.setIndex(e.index+1),e.images[0]=s.imagesHistory[e.index]):e.random()},e.prev=function(){e.index>0&&(e.setIndex(e.index-1),e.images[0]=s.imagesHistory[e.index])}}]).controller("HistoryController",["$scope","$localStorage","$state","$mdMedia",function(e,t,i,o){return t.imagesHistory?(e.divHeightStyle={height:100/3+"vw"},o("md")&&(e.divHeightStyle.height="25vw"),o("gt-md")&&(e.divHeightStyle.height=100/6+"vw"),e.history=t.imagesHistory.map(function(e){return{id:e.id,url:e.url,width:1,height:1,style:{width:"100%",overflow:"hidden"}}}),e.history.forEach(function(t,i){var o=new Image;o.onload=function(){e.history[i].width=o.width,e.history[i].height=o.height,o.height<o.width&&(e.history[i].style={height:"100%","max-width":"none","min-width":100/t.height*t.width+"%"})},o.src=t.url}),void(e.toImage=function(t){e.setHistoryIndex(!0),e.setIndex(t),i.go("index")})):i.go("index")}])}]);